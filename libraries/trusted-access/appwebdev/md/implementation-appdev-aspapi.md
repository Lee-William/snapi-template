### ASP API Reference

#### Token Endpoint
<br/>

The token endpoint consists of the following API:

- Token Exchange API – this is an API where your Mobile App can use the authorization code obtained from the authorization endpoint to exchange for the security tokens, namely the ID token and access token.  The ID token is a JSON Web Token (JWT) containing information about the identity of the user authenticated.  The access token is a security token which your Mobile App use to access API/resources of a protected domain (e.g. Government or commercial entity such as the Public Housing Agency or a bank). The access token is issued by the Authorization server of the protected domain and may be in the form of a JWT or a randomly generated reference.  Each access token comes with an expiry date, once expired, your Mobile App will have to re-authenticate the user to obtain a new access token, or alternatively, if the refresh token is provided, your Mobile App may use the refresh token to obtain a new access token without the need to re-authenticate the user.

- Refresh Token API – this is an API which supports the Refresh Token flow.  If your Mobile App is granted the refresh token privilege during Client App Registration, your Mobile App will be issued with a refresh token by the Token Exchange API, in addition to the ID token and access token.  Your Mobile App can use the refresh token subsequently to obtain a new access token for the user without the need for the user to perform user authentication again.  Refresh tokens have expiry too, but usually much long-lived than access tokens hence it is important to safe keep fresh tokens in a secure manner.  


##### Token Exchange API
<br/>

The Token API is accessed via HTTPS/REST as follows:

> Request
> 
> <b>POST {basePath}/asp/token</b>

<table>
<thead>
<tr class="header">
<th><strong>Required</strong></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Parameter</strong></td>
<td><strong>In</strong></td>
<td><strong>Type</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="even">
<td>code</td>
<td>Body</td>
<td>String</td>
<td>The authorization code obtained from the authorization endpoint</td>
</tr>
<tr class="odd">
<td>client_id</td>
<td>Body</td>
<td>String</td>
<td>The client id assigned to your Mobile App during Client App Registration</td>
</tr>
<tr class="even">
<td>client_secret</td>
<td>Body</td>
<td>String</td>
<td>The client secret that you obtained for your Mobile App during Client App Registration. This parameter may be used to hold a digital signature for certificate-based client authentication</td>
</tr>
<tr class="odd">
<td>redirect_uri</td>
<td>Body</td>
<td>String</td>
<td>The redirect URI of your Mobile App</td>
</tr>
<tr class="even">
<td>grant_type</td>
<td>Body</td>
<td>String</td>
<td>Set to &quot;authorization_code&quot;, as defined in OAuth 2.0 specifications</td>
</tr>
<tr class="odd">
<td>code_verifier</td>
<td>Body</td>
<td>String</td>
<td>The PKCE code verifier string generated by your Mobile App which will be used by the ASP to derive the code challenge, to compare with the code challenge value sent to the authorization endpoint.</td>
</tr>
</tbody>
</table>

> **Response**

<table>
<thead>
<tr class="header">
<th><strong>Success, the ID token and access token are returned</strong></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>HTTP/1.1 200 OK</p>
<p>Content-Type: application/json</p>
<p>{</p>
<p>&quot;access_token&quot; : &quot;95c06f5a-26d4-11e8-b467-0ed5f89f718b&quot;</p>
<p>&quot;id_token&quot; : &quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NiIsImtpZCI6ImdhbnltZWRlIn0.eyJjbGllbnRfaWQiOiJjb2 1lb25zcHVycyIsImV4cCI6MTIzMjEzNDEyNCwiaWF0IjoyNDEyNDEyMTM3NX0.W_4ViMyL4VhbQRvfLYb2uXSaTmrDWmtd8SGH971ORR6shpWZRoMprzGPcR8VVkwKVYvl0H_8NWSaMudnsGxwFg&quot;</p>
<p>&quot;expires_in&quot; : 600</p>
<p>&quot;token_type&quot; : &quot;Bearer&quot;</p>
<p>“refresh_token” : “24cd99ba-35da-28e4-b76e-4ef5e80f700f”</p>
<p>}</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><strong>Parameter</strong></td>
<td><strong>In</strong></td>
<td><strong>Type</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="odd">
<td>access_token</td>
<td>Body</td>
<td>String</td>
<td>The access token which can be used to access API and resources of your target protected domain. The access token may be in the form of a JWT or reference string, depending on the Authorization Server of the protected domain.</td>
</tr>
<tr class="even">
<td>id_token</td>
<td>Body</td>
<td>String</td>
<td>The ID token issued by ASP, in the form of a JWT containing identity info about the user authenticated with NDI-approved form factor. Your Mobile App will have to decode the JWT to inspect the claims in the ID token.</td>
</tr>
<tr class="odd">
<td>expires_in</td>
<td>Body</td>
<td>String</td>
<td>The lifetime (in seconds) of the access token. For example, the value &quot;600&quot; denotes the access token will expire in 10 mins from the time the response was generated.</td>
</tr>
<tr class="even">
<td>token_type</td>
<td>Body</td>
<td>String</td>
<td>The type of access token returned, which is always &quot;Bearer&quot;.</td>
</tr>
<tr class="odd">
<td>refresh_token</td>
<td>Body</td>
<td>String</td>
<td>The refresh token (if any, depending on the profile defined for the client app during Client App Registration) which the client app can use to refresh the access token.</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr class="header">
<th><strong>Client Error, invalid request (e.g. missing parameters)</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>HTTP/1.1 400 Bad Request</p>
<p>Content-Type: application/json</p>
<p>{</p>
<p>&quot;err_msg&quot; : {error_message}</p>
<p>}</p></td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr class="header">
<th><strong>Client Error, invalid endpoint URL</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>HTTP/1.1 404 Not Found</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr class="header">
<th><strong>Server Error, server-side errors encountered</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>HTTP/1.1 500 Internal Server Error</p>
<p>Content-Type: application/json</p>
<p>{</p>
<p>&quot;err_msg&quot; : {error_message}</p>
<p>}</p></td>
</tr>
</tbody>
</table>

### Refresh Token API


> The Refresh Token API let a client app obtain a new access token
> without going through user authentication. The client app must supply
> the refresh token it obtained from the Token Exchange API to the
> Refresh Token request as follows:
>
#### Request
>
<b>POST {basePath}/asp/token</b>

<table>
<thead>
<tr class="header">
<th><strong>Required</strong></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Parameter</strong></td>
<td><strong>In</strong></td>
<td><strong>Type</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="even">
<td>client_id</td>
<td>Body</td>
<td>String</td>
<td>The client id assigned to your client app during Client App Registration</td>
</tr>
<tr class="odd">
<td>client_secret</td>
<td>Body</td>
<td>String</td>
<td>The client secret that you obtained for your client app during Client App Registration</td>
</tr>
<tr class="even">
<td>grant_type</td>
<td>Body</td>
<td>String</td>
<td>Set to “refresh_token”, as defined in OAuth 2.0 specifications</td>
</tr>
<tr class="odd">
<td>refresh_token</td>
<td>Body</td>
<td>String</td>
<td>The refresh token obtained from the token endpoint (Token Exchange API)</td>
</tr>
<tr class="even">
<td><strong>Optional</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><strong>Parameter</strong></td>
<td><strong>In</strong></td>
<td><strong>Type</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="even">
<td>scope</td>
<td>Body</td>
<td>String</td>
<td>Space delimited and case-sensitive list of strings of OAuth 2.0 scope values, indicating the scope of access requested. Each scope value references a scope profile defined for your client app during Client App Registration. If not provided, default to &quot;openid&quot;</td>
</tr>
</tbody>
</table>

#### Response

<table>
<thead>
<tr class="header">
<th><strong>Success, the ID token and access token are returned</strong></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>HTTP/1.1 200 OK</p>
<p>Content-Type: application/json</p>
<p>{</p>
<p>&quot;access_token&quot; : &quot;95c06f5a-26d4-11e8-b467-0ed5f89f718b&quot;</p>
<p>&quot;token_type&quot; : &quot;Bearer&quot;</p>
<p>&quot;expires_in&quot; : 600</p>
<p>“refresh_token” : “77a906e51-94d4-26e8-cd6f-aed2fb9fa38e”</p>
<p>}</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><strong>Parameter</strong></td>
<td><strong>In</strong></td>
<td><strong>Type</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="odd">
<td>access_token</td>
<td>Body</td>
<td>String</td>
<td>The access token which can be used to access API and resources of your target protected domain. The access token may be in the form of a JWT or reference string, depending on the Authorization Server of the protected domain.</td>
</tr>
<tr class="even">
<td>expires_in</td>
<td>Body</td>
<td>String</td>
<td>The lifetime (in seconds) of the access token. For example, the value &quot;600&quot; denotes the access token will expire in 10 mins from the time the response was generated.</td>
</tr>
<tr class="odd">
<td>token_type</td>
<td>Body</td>
<td>String</td>
<td>The type of access token returned, which is always &quot;Bearer&quot;.</td>
</tr>
<tr class="even">
<td>refresh_token</td>
<td>Body</td>
<td>String</td>
<td>The new refresh token (if any) which the client app can use to refresh the access token.</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr class="header">
<th><strong>Client Error, invalid request (e.g. missing parameters)</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>HTTP/1.1 400 Bad Request</p>
<p>Content-Type: application/json</p>
<p>{</p>
<p>&quot;error&quot; : {error_message}</p>
<p>}</p></td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr class="header">
<th><strong>Client Error, invalid endpoint URL</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>HTTP/1.1 404 Not Found</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr class="header">
<th><strong>Server Error, server-side errors encountered</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>HTTP/1.1 500 Internal Server Error</p>
<p>Content-Type: application/json</p>
<p>{</p>
<p>&quot;error&quot; : {error_message}</p>
<p>}</p></td>
</tr>
</tbody>
</table>
