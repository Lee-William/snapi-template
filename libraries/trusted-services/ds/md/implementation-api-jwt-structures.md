# JWT Specifications
      
## DSP/RP Client Notification Token (Client Notification Endpoint)
    
   As per OpenID Connect's [CIBA Push flow](https://openid.net/specs/openid-client-initiated-backchannel-authentication-core-1_0.html#rfc.section.9), all requests to the client notification endpoint is authorized via a client notification token that was first issued by the DSP/RP at the QR Authentication Endpoint. The recommended structure of the client notification token is as follow:

   <div class="table-responsive-sm">
        <table class="table table-striped table-bordered mb-0">
        <thead>
        <tr>
        <th>PARAMETER</th>
        <th>DESCRIPTION</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td>header</td>
        <td>
          <div>algo : "ES256"</div>
          <div>kid :  "The key ID that can be used to reference the corresponding public key from a jwks endpoint"</div>
        </td>
        </tr>
        <tr>
        <td>payload</td>
        <td>
        <div>
            nonce : "A uniquely generated nonce to ensure that the token can never be replayed"
        </div>
        <div>
            exp : "expiry duration in seconds"
        </div>
        <div>
            iat : "unix timestamp in seconds to specify exact point of time this token was issued"
        </div>
        </td>
        </tr>
        <tr>
        <td>signature</td>
        <td>
            ECDSA-sha256 ( header + "." + payload, privateKey)
        </td>
        </tr>
        </thread>
        </table>
        </div>

<h2> Internal Tokens Between HSS and NDI Mobile </h2>
        
<b>Signed Challenge</b>

The signedChallenge is a JWS object sent back to the NDI Mobile as a response to the Signature Reference Challenge endpoint

<div class="table-responsive-sm">
    <table class="table table-striped table-bordered mb-0">
    <thead>
    <tr>
    <th>PARAMETER</th>
    <th>DESCRIPTION</th>
    </tr>
    </thead>
    <tbody>
    <tr>
    <td>header</td>
    <td>
    <div>algo : "ES256"</div>
    <div>kid :  "The key ID that can be used to reference the corresponding public key from the asp's jwks endpoint"</div>
    </td>
    </tr>
    <tr>
    <td>payload</td>
    <td>
    <div>
        sign_ref : "Digital Signing Reference ID. This has to be the same value as the sign_ref in the request path."
    </div>
    <div>
        doc_hash : "The PaDes document generated by the DSP/RP"
    </div>
    <div>
        challenge_code : "6-digit challenge code to be verified by end-user"
    </div>
    <div>
        exp : "expiry duration in seconds. i.e 3 seconds"
    </div>
    <div>
        iat : "unix timestamp in seconds to specify exact point of time this token was issued"
    </div>
    <div>
        hss_nonce : "A uniquely generated server-side nonce from the HSS. This value has to be passed back to the HSS as a claim within the signedResponse."
    </div>
    <div>
        nonce : "An echo-ed back nonce that was passed to the HSS as a request to the Signature Reference Challenge endpoint (POST)."
    </div>
    </td>
    </tr>
    <tr>
    <td>signature</td>
    <td>
      ECDSA-sha256 ( header + "." + payload, privateKey)
    </td>
    </tr>
    </thread>
    </table>
</div>
    
<b>Signed Response</b>
	   
The signedResponse is a JWS object sent to the HSS as a request to the update signature reference endpoint (PUT).
    
<div class="table-responsive-sm">
    <table class="table table-striped table-bordered mb-0">
    <thead>
    <tr>
    <th>PARAMETER</th>
    <th>DESCRIPTION</th>
    </tr>
    </thead>
    <tbody>
    <tr>
    <td>header</td>
    <td>
        <div>algo : "ES256"</div>
      <div>kid :  "The key ID that can be used to reference the corresponding public key from the asp's jwks endpoint"</div>
      <div>x5c :  "The end-user's public certificate"</div>
    </td>
    </tr>
    <tr>
    <td>payload</td>
    <td>
    <div>
        sign_ref : "Digital Signing Reference ID. This has to be the same value as the sign_ref in the request path."
    </div>
    <div>
        ff_id : "The form-factor identifier that corresponds to the end-user's registered mobile device. This is a value that is allocated to each device upon form-factor provisioning."
    </div>
    <div>
        doc_hash : "The PaDes document generated by the DSP/RP"
    </div>
    <div>
        challenge_code : "6-digit challenge code verified by end-user"
    </div>
    <div>
        usr_signature : "End user's signature over the document hash"
    </div>
    <div>
        exp : "expiry duration in seconds. i.e 3 seconds"
    </div>
    <div>
        iat : "unix timestamp in seconds to specify exact point of time this token was issued"
    </div>
    <div>
        hss_nonce : "A uniquely generated server-side nonce from the HSS's Signature Reference Challenge Endpoint. This value has to be passed back to the HSS as a claim within the signedResponse."
    </div>
    <div>
        timestamp : "unix timestamp in milliseconds to specify the exact point of time the user signed on the document hash"
    </div>
    </td>
    </tr>
    <tr>
    <td>signature</td>
    <td>
      ECDSA-sha256 ( header + "." + payload, privateKey)
    </td>
    </tr>
    </thread>
    </table>
</div>